---
WebSocket: 沙盒里的 TCP
---

#### 前言

WebSocket 是一种基于 TCP、运行在浏览器环境里的一个应用层协议。

为什么要有 WebSocket 呢？其实 WebSocket 与 HTTP/2 一样，都是为了解决 HTTP 某方面的缺陷而产生的。HTTP/2 针对的是应用层的 "队头阻塞"，而 WebSocket 针对的是 "请求响应" 通信模式。

 "请求响应" 通信模式有啥不好的呢？

 "请求响应" 是一种半双工的通信模式，虽然可以双向收发数据，但同一时刻只能一个方向上有动作，传输效率低。更关键的一点，它是一种被动的通信模式，服务器只能被动响应客户端的请求，无法主动向客户端发送数据。

虽然后来的 HTTP/2、HTTP/3 新增了 Stream、Server Push 等特性，但请求响应模式模式依然是主流的工作方式。这就导致 HTTP 难以应用在动态页面、即时消息、网络游戏等要求实时通信的领域。

#### 特点

WebSocket 是一个真正的全双工的通信协议，它采用了二进制帧结构，服务发现方面，没有采用 TCP 的 "IP + 端口号"，而是延用了 HTTP 的 URI 格式，但是协议头变成了 "ws" 和 "wss"，分别代表明文和加密的 WebSocket 协议。

和 TCP、TLS 一样，WebSocket 也要有一个握手过程，然后才能正式的收发数据。

不过它是使用的 HTTP "协议升级" 的特性，即 101 Switching Protocols。